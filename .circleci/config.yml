version: 2
jobs:
  build:
    docker:
      - image: cimg/go:1.18.2
    environment:
      TERM: dumb
      YARN_SILENT: 1
    steps:
      - checkout
      - run:
          name: Checkout submodule
          command: |
            git submodule update --init --recursive
      - restore_cache:
          keys:
            - v1-dependencies-{{ checksum "go.sum" }}
            - v1-dependencies-
      # - run:
      #     name: Test
      #     command: |
      #       ./gradlew clean check jacocoTestReport
      #       bash <(curl -s https://codecov.io/bash)
      # - run:
      #     name: Build
      #     command: |
      #       ./gradlew clean :app:bootJar
      - save_cache:
          key: v1-dependencies-{{ checksum "go.sum" }}
          paths:
            - /go/pkg/mod

      # - run:
      #     name: Deployment
      #     command: |
      #       if [ "$CIRCLE_BRANCH" == "main" ]; then
      #         ./.circleci/setup-heroku.sh
      #         ./.circleci/setup-retry.sh
      #         retry -- heroku plugins:install java
      #         retry -- heroku deploy:jar \
      #           --jar app/build/libs/app.jar \
      #           --jdk 11 \
      #           --app $HEROKU_APP
      #       fi
